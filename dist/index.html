<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>My Island VR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-teleport-controls@0.3.3/dist/aframe-teleport-controls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/super-hands@4.0.5/dist/super-hands.min.js"></script>
  </head>
  <body>
    <a-scene
      background="color: #000"
      renderer="antialias: true"
      vr-mode-ui="enabled: true"
      cursor="rayOrigin: mouse"
      raycaster="objects: .clickable, .clickable1"
    >
      <!-- Assets -->
      <a-assets>
        <audio id="elk-sound" src="/audio/elk.mp3" preload="auto"></audio>
        <audio id="owl-sound" src="/audio/owl.mp3" preload="auto"></audio>
        <audio id="birds-sound" src="/audio/birds.mp3" preload="auto"></audio>
        <audio id="woman-sound" src="/audio/woman.mp3" preload="auto"></audio>
        <a-asset-item
          id="forest-floor"
          src="/models/forest-floor.glb"
        ></a-asset-item>
        <a-asset-item
          id="ladyflowers"
          src="/models/ladyflowers.glb"
        ></a-asset-item>
        <a-asset-item
          id="fantasy-house"
          src="/models/fantasy-house.glb"
        ></a-asset-item>
        <a-asset-item
          id="mushroom-house"
          src="/models/mushroom-house.glb"
        ></a-asset-item>
        <a-asset-item id="sky-house" src="/models/sky-house.glb"></a-asset-item>
        <a-asset-item id="elk" src="/models/elk.glb"></a-asset-item>
        <a-asset-item id="castle" src="/models/castle.glb"></a-asset-item>
        <a-asset-item id="owl" src="/models/owl.glb"></a-asset-item>
        <a-asset-item
          id="island-red-sky"
          src="/models/island-red-sky.glb"
        ></a-asset-item>
        <a-asset-item
          id="winter-island"
          src="/models/winter-island.glb"
        ></a-asset-item>
        <a-asset-item
          id="stone-floor"
          src="/models/stone-floor.glb"
        ></a-asset-item>
      </a-assets>

      <!-- Sky -->
      <a-sky
        src="/images/stars-sky.jpg"
        rotation="0 0 0"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 60000; easing: linear"
      >
      </a-sky>

      <!-- Environment Models (No change needed) -->
      <a-entity
        gltf-model="#forest-floor"
        position="-5 -1 -2"
        scale="5 5 5"
        rotation="0 -90 0"
      ></a-entity>
      <a-entity
        gltf-model="#island-red-sky"
        position="0 -9 0"
        scale="1 1 1"
        rotation="0 -90 0"
      ></a-entity>
      <a-entity
        gltf-model="#sky-house"
        position="-14 4 3"
        scale="0.04 0.04 0.04"
        rotation="0 45 0"
      ></a-entity>
      <a-entity
        gltf-model="#winter-island"
        position="-20 -1 8"
        scale="0.5 0.5 0.5"
        rotation="10 5 0"
      ></a-entity>
      <a-entity
        gltf-model="#castle"
        position="12 5 -15"
        scale="1.5 1.5 1.5"
        rotation="18 5 2"
      ></a-entity>
      <a-entity
        gltf-model="#fantasy-house"
        position="-5 0.1 0"
        scale="7 7 7"
        rotation="5 -5 0"
      ></a-entity>
      <a-entity
        gltf-model="#mushroom-house"
        position="5 0 3"
        scale="25 25 25"
        rotation="0 -90 0"
      ></a-entity>
      <a-entity
        gltf-model="#stone-floor"
        position="2 0 0"
        scale="5 5 5"
      ></a-entity>
      <a-entity
        gltf-model="#stone-floor"
        position="5 1 -13"
        scale="12 12 12"
      ></a-entity>
      <a-entity
        gltf-model="#stone-floor"
        position="-2 -0.2 4"
        scale="5 5 5"
      ></a-entity>

      <!-- Interactable Models -->
      <a-entity
        id="elk-click"
        class="clickable"
        elk-action
        gltf-model="#elk"
        position="-12 0 8"
        scale="1 1 1"
        rotation="0 45 0"
      ></a-entity>
      <a-entity
        id="owl-click"
        class="clickable"
        owl-action
        gltf-model="#owl"
        position="20 5 -5"
        scale="2 2 2"
        rotation="0 -90 0"
      ></a-entity>
      <a-entity
        id="ladyflowers-click"
        class="clickable1"
        ladyflowers-action
        gltf-model="#ladyflowers"
        position="-28 -4 0"
        scale="0.015 0.015 0.015"
        rotation="0 -240 0"
      ></a-entity>

      <!-- WebXR Camera Rig with Controllers -->
      <a-entity id="cameraRig" position="0 1.6 0">
        <a-entity
          id="head"
          camera
          look-controls
          wasd-controls
          position="0 0 0"
        ></a-entity>
        <a-entity
          laser-controls="hand: left"
          raycaster="objects: .clickable, .clickable1"
        ></a-entity>
        <a-entity
          laser-controls="hand: right"
          raycaster="objects: .clickable, .clickable1"
        ></a-entity>
      </a-entity>

      <!-- Teleport Controls -->
      <a-entity
        teleport-controls="cameraRig: #cameraRig; teleportOrigin: #head; button: trigger;"
        raycaster="objects: a-plane, .clickable"
      ></a-entity>
    </a-scene>

    <!-- Interaction Scripts -->
    <script>
      AFRAME.registerComponent("elk-action", {
        init: function () {
          const el = this.el;
          const sound = document.querySelector("#elk-sound");

          el.addEventListener("click", () => {
            if (sound) {
              sound.currentTime = 0;
              sound.play().catch(console.log);
            }

            el.setAttribute("animation__move", {
              property: "position",
              to: "-12 0 15",
              dur: 2000,
              easing: "easeInOutQuad",
            });

            el.setAttribute("animation__rotate", {
              property: "rotation",
              to: "0 180 0",
              dur: 1000,
              easing: "easeInOutQuad",
            });
          });
        },
      });

      AFRAME.registerComponent("owl-action", {
        init: function () {
          const el = this.el;
          const sound = document.querySelector("#owl-sound");

          el.addEventListener("click", () => {
            if (sound) {
              sound.currentTime = 0;
              sound.play().catch(console.log);
            }

            el.setAttribute("animation__fly", {
              property: "position",
              to: "-20 9 3",
              dur: 3000,
              easing: "easeInOutSine",
            });

            el.setAttribute("animation__flap", {
              property: "rotation",
              to: "0 -90 15",
              dur: 500,
              direction: "alternate",
              loop: 6,
              easing: "easeInOutSine",
            });
          });
        },
      });

      AFRAME.registerComponent("ladyflowers-action", {
        init: function () {
          const el = this.el;
          const sound = document.querySelector("#woman-sound");

          el.addEventListener("click", () => {
            if (sound) {
              sound.currentTime = 0;
              sound.play().catch(console.log);
            }
          });
        },
      });

      document.addEventListener("DOMContentLoaded", function () {
        const birdsSound = document.querySelector("#birds-sound");
        if (birdsSound) {
          birdsSound.loop = true;
          birdsSound.volume = 0.3;
          document.addEventListener("click", function playSoundOnce() {
            birdsSound.play().catch(console.log);
            document.removeEventListener("click", playSoundOnce);
          });
        }

        document.querySelectorAll(".clickable, .clickable1").forEach((el) => {
          el.addEventListener("mouseenter", () => {
            el.setAttribute("animation__hover", {
              property: "scale",
              to: "1.1 1.1 1.1",
              dur: 200,
              easing: "easeOutQuad",
            });
          });
          el.addEventListener("mouseleave", () => {
            el.setAttribute("animation__hover", {
              property: "scale",
              to: "1 1 1",
              dur: 200,
              easing: "easeOutQuad",
            });
          });
        });
      });
    </script>
  </body>
</html>
